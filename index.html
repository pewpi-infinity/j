cat << 'EOF' > install_infinity_os.sh
#!/bin/bash

echo "Installing Infinity OS Directory Structure..."

# ==============================
# Create directory tree
# ==============================
mkdir -p /j/public
mkdir -p /j/system/core
mkdir -p /j/system/portal
mkdir -p /j/system/token

# ==============================
# public/index.html
# ==============================
cat << 'EOT' > /j/public/index.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Infinity Viewer Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f7faff;
            color: #002b57;
            text-align: center;
        }

        .header {
            background: #007bff;
            padding: 20px 0;
            color: white;
            font-size: 26px;
            font-weight: bold;
        }

        .container {
            margin-top: 40px;
        }

        .btn {
            display: block;
            width: 80%;
            max-width: 300px;
            margin: 14px auto;
            padding: 16px;
            background: #ffffff;
            border: 2px solid #007bff;
            border-radius: 14px;
            color: #007bff;
            font-size: 18px;
            font-weight: bold;
            text-decoration: none;
            transition: 0.2s;
        }

        .btn:hover {
            background: #007bff;
            color: #ffffff;
        }

        footer {
            margin-top: 40px;
            color: #4e6a80;
            font-size: 14px;
        }
    </style>
</head>

<body>

    <div class="header">
        Infinity Public Viewer
    </div>

    <div class="container">

        <a class="btn" href="/system/portal/viewer_directory.os">
            Open Viewer Directory
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?token">
            Token Viewer
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?cubeportal">
            Cube Portal Viewer
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?sandbox">
            Sandbox Particle Viewer
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?hypercube">
            Hypercube Display
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?missions">
            Mission Viewer
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?tasks">
            Task Viewer
        </a>

        <a class="btn" href="/system/portal/viewer_directory.os?market">
            Marketplace Viewer
        </a>

    </div>

    <footer>
        Protected by Infinity Shadow Gateway<br>
        Backend Modules Are Not Accessible
    </footer>

</body>
</html>
EOT

# ==============================
# public/loader.js
# ==============================
cat << 'EOT' > /j/public/loader.js
document.addEventListener("DOMContentLoaded", () => {
    const links = document.querySelectorAll("a.btn");
    links.forEach(link => {
        link.addEventListener("click", (e) => {
            e.preventDefault();
            let query = "";
            const href = link.getAttribute("href");
            if (href.includes("?")) query = href.split("?")[1];
            const gatewayURL = "/system/core/shadow_gateway.os?" + query;
            fadeOut(() => window.location = gatewayURL);
        });
    });
});

function fadeOut(callback) {
    const body = document.body;
    body.style.transition = "opacity 0.3s ease";
    body.style.opacity = "0";
    setTimeout(callback, 300);
}
EOT

# ==============================
# system/core/protect_router.os
# ==============================
cat << 'EOT' > /j/system/core/protect_router.os
#!/bin/infinity

APPROVED=(
  "/system/portal/token_viewer_cube_sandbox.os"
  "/system/portal/viewer_directory.os"
  "/system/core/shadow_gateway.os"
)

is_approved() {
  for A in "${APPROVED[@]}"; do
    if [ "$1" = "$A" ]; then return 0; fi
  done
  return 1
}

route() {
  TARGET="$1"
  if is_approved "$TARGET"; then
    "$TARGET"
  else
    /system/core/dummy_shell.os "$TARGET"
  fi
}

if [ "$1" != "" ]; then
  route "$1"
fi
EOT

# ==============================
# system/core/shadow_gateway.os
# ==============================
cat << 'EOT' > /j/system/core/shadow_gateway.os
#!/bin/infinity

VIEWER_SAFE=(
  "viewer_directory"
  "token_viewer_cube_sandbox"
)

safe() {
  for V in "${VIEWER_SAFE[@]}"; do
    [[ "$1" == *"$V"* ]] && return 0
  done
  return 1
}

if safe "$1"; then
  /system/portal/token_viewer_cube_sandbox.os
else
  /system/core/dummy_shell.os "$1"
fi
EOT

# ==============================
# system/core/dummy_shell.os
# ==============================
cat << 'EOT' > /j/system/core/dummy_shell.os
#!/bin/infinity

clear
echo "INFINITY ACCESS POINT"
echo "────────────────────────"
echo "This area is restricted."
echo "Only public viewer modules are available."
echo ""
echo "No backend execution permitted."
echo "No internal modules exposed."
echo "No private system access."
echo ""
echo "Return to Viewer Directory."
echo "────────────────────────"
read -p "Press Enter..."
EOT

# ==============================
# system/portal/viewer_directory.os
# ==============================
cat << 'EOT' > /j/system/portal/viewer_directory.os
#!/bin/infinity

viewer_call() {
  case "$1" in
    token)    /system/portal/token_viewer_cube_sandbox.os ;;
    portal)   /system/portal/token_viewer_cube_sandbox.os ;;
    sandbox)  /system/portal/token_viewer_cube_sandbox.os ;;
    cube)     /system/portal/token_viewer_cube_sandbox.os ;;
  esac
}

while true; do
  clear
  echo "INFINITY — PUBLIC VIEWER DIRECTORY"
  echo "─────────────────────────────────────"
  echo "1) Token Viewer"
  echo "2) Cube Portal Viewer"
  echo "3) Sandbox Particle Viewer"
  echo "4) Infinity Hybrid Viewer"
  echo "q) Quit"
  read -p "> " CH

  case "$CH" in
    1) viewer_call token ;;
    2) viewer_call portal ;;
    3) viewer_call sandbox ;;
    4) viewer_call cube ;;
    q) break ;;
  esac
done
EOT

# ==============================
# system/portal/token_viewer_cube_sandbox.os
# ==============================
cat << 'EOT' > /j/system/portal/token_viewer_cube_sandbox.os
#!/bin/infinity

source /system/token/token_engine.os

cube_frame="
       +--------------+
      /   PORTAL     /|
     +--------------+ |
     |   TOKEN      | |
     |   VIEWER     |/
     +--------------+
"

draw_sandbox() {
  clear
  echo "INFINITY SANDBOX VIEWER"
  echo "────────────────────────────"
  for i in {1..12}; do
    printf "   "
    case $((RANDOM % 4)) in
      0) echo "·   ·   ◦" ;;
      1) echo "◦   •   ·" ;;
      2) echo "•   ·   ◦" ;;
      3) echo "·   ◦   •" ;;
    esac
    sleep 0.05
  done
}

token_viewer() {
  clear
  echo "$cube_frame"
  echo ""
  echo "Visible Tokens (read-only): $TOKEN"
  read -p "Press Enter..."
}

portal_visualizer() {
  for s in "(◉)" "((◉))" "(((◉)))" "((((◉))))" "(((((◉)))))"; do
    clear
    echo "PORTAL VIEWER"
    echo "──────────────"
    echo "$s"
    sleep 0.12
  done
  read -p "Press Enter..."
}

while true; do
  clear
  echo "INFINITY VIEWER MODULE"
  echo "1) Tokens"
  echo "2) Portal"
  echo "3) Sandbox"
  echo "q) Quit"
  read -p "> " CH

  case "$CH" in
    1) token_viewer ;;
    2) portal_visualizer ;;
    3) draw_sandbox ;;
    q) break ;;
  esac
done
EOT

# ==============================
# Done!
# ==============================
echo "Infinity OS Installed under /j"
EOF
