<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Infinity Octave OS — Terminal v1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020712;
      --panel: #050b18;
      --border: #1b3d6b;
      --accent: #29d9ff;
      --text-main: #e9f4ff;
      --text-soft: #a7c0e0;
      --wallet: #21ff9c;
    }

    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #06142b 0, #020712 48%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .shell { width: 100%; max-width: 960px; padding: 20px 14px 32px; }

    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
    .brand-line { font-size: 13px; color: var(--accent); letter-spacing: 0.25em; }
    .header-title { font-size: 24px; font-weight: 800; letter-spacing: 0.06em; text-transform: uppercase; }

    .portal-link { font-size: 13px; color: var(--text-soft); }
    .portal-link::before { content: "⧉ "; }

    .terminal-card {
      background: radial-gradient(circle at top left, #0b1630, #050b18 48%, #020811);
      border-radius: 22px;
      padding: 18px 14px;
      border: 1px solid rgba(45,120,210,0.6);
      box-shadow: 0 0 45px rgba(0,0,0,0.7);
    }

    .button-row { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 16px; }
    .pill-btn {
      min-width: 120px; padding: 9px 16px;
      background: rgba(5,15,30,0.85);
      border: 1px solid rgba(104,168,255,0.6);
      border-radius: 999px;
      color: #dff3ff;
      cursor: pointer;
      font-size: 14px;
      text-transform: uppercase;
      font-weight: 600;
    }
    .pill-btn.active { border-color: var(--accent); box-shadow: 0 0 12px var(--accent); }

    .pill-btn.wallet { border-color: var(--wallet); color: var(--wallet); }
    .pill-btn.wallet::before { content: "∞ "; }

    .status-row {
      display: flex; justify-content: space-between;
      padding: 0 4px; margin-bottom: 10px;
      font-size: 13px; color: var(--text-soft);
    }
    #modeLabel { color: var(--accent); }

    .token-pill {
      padding: 3px 8px; border-radius: 999px;
      border: 1px solid #21ff9c;
      background: rgba(0,255,163,0.12);
      color: var(--wallet); font-weight: 600;
    }

    .console {
      height: 260px;
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(35,70,130,0.7);
      border-radius: 14px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 14px;
    }
    .console-line { margin-bottom: 5px; }
    .console-line.system { color: #93b7ff; }
    .console-line.you { color: #7ef9ff; }
    .console-line.ai { color: #ffd997; }

    .input-row { display: flex; gap: 8px; align-items: center; }
    .input-box {
      flex: 1;
      background: rgba(0,10,30,0.8);
      border: 1px solid rgba(40,110,200,0.8);
      border-radius: 999px;
      padding: 8px 14px;
    }
    .input-box input { background: transparent; border: none; color: var(--text-main); width: 100%; }

    .post-btn {
      padding: 9px 22px;
      background: linear-gradient(to bottom, #21ff9c, #15996c);
      border-radius: 999px;
      border: none;
      color: #00130a;
      font-weight: 800;
      text-transform: uppercase;
      cursor: pointer;
    }

    /* Visitor Widget (small) */
    #visitorBox {
      position: fixed;
      top: 18px; right: 18px;
      width: 145px; height: 85px;
      background: rgba(0,20,40,0.82);
      border: 1px solid #29d9ff;
      border-radius: 14px;
      padding: 8px 10px;
      font-size: 12px;
      box-shadow: 0 0 16px rgba(41,217,255,0.4);
      z-index: 999;
      transition: all 0.2s ease;
      overflow: hidden;
      cursor: pointer;
    }

    #visitorBox.expanded {
      width: 300px; height: 220px; padding: 12px 14px;
    }

    #visitorMap {
      width: 100%;
      height: 110px;
      margin-top: 6px;
      background: rgba(0,60,70,0.15);
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <div class="shell">
    <header>
      <div>
        <div class="brand-line">INFINITY OCTAVE OS</div>
        <div class="header-title">Infinity Octave OS — Terminal v1</div>
      </div>
      <div class="portal-link"><span>∞ Infinity Portal</span></div>
    </header>

    <main>
      <section class="terminal-card">
        <div class="button-row">
          <button class="pill-btn active" data-mode-btn="conversate">Conversate</button>
          <button class="pill-btn" data-mode-btn="secret">Secret Encode</button>
          <button class="pill-btn" data-mode-btn="retrieve">Retrieve</button>
          <button class="pill-btn" data-mode-btn="builder">Builder</button>
          <button class="pill-btn" data-mode-btn="post">Post</button>
          <button class="pill-btn wallet">Wallet</button>
        </div>

        <div class="status-row">
          <span>Mode: <strong id="modeLabel">Conversate</strong></span>
          <span class="token-pill"><span id="tokenCount">10</span> INF</span>
        </div>

        <div class="console" id="console"></div>

        <div class="input-row">
          <div class="input-box">
            <input id="input" placeholder="Hello Rogers..." autocomplete="off" />
          </div>
          <button class="post-btn" id="postBtn">Post</button>
        </div>

      </section>
    </main>
  </div>

  <!-- Core Systems -->
  <script src="js/octave-core.js"></script>
  <script src="token-engine.js"></script>
  <script src="core-writer.js"></script>
  <script src="module_ip_login.js"></script>

  <!-- Expansion Modules -->
  <script src="module_music_player.js"></script>
  <script src="module_video_panel.js"></script>
  <script src="module_equation_lab.js"></script>
  <script src="module_microapps_buttons.js"></script>
  <script src="module_3d_engine.js"></script>
  <script src="module_pay_advertise.js"></script>

  <script>
    /* Visitor Counter */
    (async function(){
      let count = Number(localStorage.getItem("infinity_page_views") || 0);
      count++;
      localStorage.setItem("infinity_page_views", count);
      document.getElementById("viewCount").textContent = count;

      async function getGeo(){
        try { let r = await fetch("https://ipapi.co/json/"); return r.json(); }
        catch { return null; }
      }

      const geo = await getGeo();
      if(geo){
        document.getElementById("visitorLoc").textContent =
          `${geo.city}, ${geo.region}, ${geo.country_name}`;
        drawDot(geo.latitude, geo.longitude);
      }

      function drawDot(lat, lon){
        const c = document.getElementById("visitorMap");
        const ctx = c.getContext("2d");
        ctx.fillStyle = "#011";
        ctx.fillRect(0,0,c.width,c.height);
        let x = (lon + 180) * (c.width / 360);
        let y = (90 - lat) * (c.height / 180);
        ctx.beginPath();
        ctx.arc(x,y,4,0,Math.PI*2);
        ctx.fillStyle = "#29d9ff";
        ctx.fill();
      }

      document.getElementById("visitorBox").addEventListener("click",()=>{
        visitorBox.classList.toggle("expanded");
      });

    })();
  </script>
<script src="module_media_dock.js"></script>
<!-- MODULE: Video Player Dock -->
<style>
  #mediaDockBtn {
    position: fixed; bottom: 22px; right: 22px;
    background: #29d9ff; color: #001018;
    border-radius: 50%; width: 58px; height: 58px;
    border: none; font-size: 26px; font-weight: 900;
    cursor: pointer; z-index: 999;
    box-shadow: 0 0 18px #29d9ff;
  }

  #mediaDockPanel {
    position: fixed; bottom: 0; left: 0;
    width: 100%; height: 60%;
    background: #020712ef;
    border-top: 1px solid #29d9ff80;
    display: none; padding: 18px;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.8);
    z-index: 998; overflow-y: auto;
  }

  #mediaList div {
    padding: 8px 0; cursor: pointer;
    color: #a7c0e0; border-bottom: 1px solid #133;
  }
</style>

<button id="mediaDockBtn">▶</button>

<div id="mediaDockPanel">
  <h2 style="margin-top:0;">Media Player</h2>

  <input type="file" id="mediaUpload" accept="video/*,audio/*" />

  <video id="mediaPlayer" controls style="width:100%; margin-top:14px;"></video>

  <h3>Stored Files</h3>
  <div id="mediaList"></div>
</div>

<script>
(function(){
  const dockBtn = document.getElementById("mediaDockBtn");
  const panel = document.getElementById("mediaDockPanel");
  const upload = document.getElementById("mediaUpload");
  const player = document.getElementById("mediaPlayer");
  const list = document.getElementById("mediaList");

  let store = JSON.parse(localStorage.getItem("inf_media_store")||"[]");

  function renderList(){
    list.innerHTML="";
    store.forEach((item,i)=>{
      const el=document.createElement("div");
      el.textContent=item.name;
      el.onclick=()=>{ player.src=item.data; };
      list.appendChild(el);
    });
  }

  dockBtn.onclick = ()=>{ 
    panel.style.display = (panel.style.display==="none"||!panel.style.display)
      ? "block" : "none"; 
  };

  upload.onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;
    const rd = new FileReader();
    rd.onload = ()=>{
      store.push({ name:file.name, data: rd.result });
      localStorage.setItem("inf_media_store", JSON.stringify(store));
      renderList();
      player.src = rd.result;
    };
    rd.readAsDataURL(file);
  };

  renderList();
})();
</script>
<!-- MODULE: Hamburger Storage Drawer -->
<style>
  #hamburgerBtn {
    position: fixed; top: 20px; left: 20px;
    width: 44px; height: 44px;
    border-radius: 12px;
    background: #0b162ecc;
    border: 1px solid #29d9ff;
    color: #29d9ff; font-size: 24px;
    cursor: pointer; z-index: 900;
  }
  #drawer {
    position: fixed; top: 0; left: 0;
    width: 260px; height: 100%;
    background: #020712f7;
    border-right: 1px solid #29d9ff60;
    transform: translateX(-100%);
    transition: 0.25s ease;
    z-index: 899; padding: 20px;
    overflow-y: auto;
  }
  #drawer.open { transform: translateX(0); }
  #drawer h3 { margin-top: 26px; }
  #drawer .file-entry { padding: 6px 0; cursor:pointer; }
</style>

<button id="hamburgerBtn">☰</button>
<div id="drawer">
  <h2>Storage</h2>
  <div id="drawerAudio"></div>
  <div id="drawerVideo"></div>
  <div id="drawerGames"></div>
</div>

<script>
(function(){
  const btn=document.getElementById("hamburgerBtn");
  const dr=document.getElementById("drawer");

  btn.onclick = ()=> dr.classList.toggle("open");

  function loadDrawer(){
    const store = JSON.parse(localStorage.getItem("inf_media_store")||"[]");
    const A=document.getElementById("drawerAudio");
    const V=document.getElementById("drawerVideo");
    const G=document.getElementById("drawerGames");

    A.innerHTML="<h3>Audio</h3>";
    V.innerHTML="<h3>Video</h3>";
    G.innerHTML="<h3>Games</h3>";

    store.forEach(f=>{
      let target = f.name.match(/\.(mp3|wav|ogg)$/i) ? A :
                   f.name.match(/\.(mp4|webm|mkv)$/i) ? V : G;

      const el=document.createElement("div");
      el.className="file-entry";
      el.textContent=f.name;
      el.onclick = ()=> navigator.clipboard.writeText(f.data);
      target.appendChild(el);
    });
  }

  loadDrawer();
  window.addEventListener("storage", loadDrawer);
})();
</script>
<!-- MODULE: Local Offline Conversational AI -->
<script>
(function(){

  const consoleBox = document.getElementById("console");
  const input = document.getElementById("input");
  const postBtn = document.getElementById("postBtn");

  // Small local “AI brain”
  let memory = JSON.parse(localStorage.getItem("inf_local_memory")||"[]");

  function aiThink(msg){
    memory.push(msg);
    if(memory.length>200) memory.shift();
    localStorage.setItem("inf_local_memory",JSON.stringify(memory));

    // Simple pattern AI
    if(msg.toLowerCase().includes("hello")) 
      return "Hey, I'm here. What’s next?";
    if(msg.toLowerCase().includes("music")) 
      return "Music module ready. Want me to load the dock?";
    if(msg.toLowerCase().includes("video")) 
      return "Video player online. Upload through the dock.";
    
    // Fallback = remix memory patterns
    let last = memory.slice(-3).join(" / ");
    return "Thinking from memory: " + last;
  }

  function write(type,text){
    const line=document.createElement("div");
    line.className="console-line "+type;
    line.textContent=text;
    consoleBox.appendChild(line);
    consoleBox.scrollTop=consoleBox.scrollHeight;
  }

  function send(){
    const msg=input.value.trim();
    if(!msg) return;
    write("you",msg);
    const res=aiThink(msg);
    write("ai",res);
    input.value="";
  }

  input.addEventListener("keydown",e=>{
    if(e.key==="Enter") send();
  });

  postBtn.onclick = send;

})();
</script>
<!-- MEDIA SYSTEM v2 — Audio + Video + Storage (Stable Build) -->

<style>
  /* FONT RESET FOR THIS MODULE ONLY */
  .media-safe, .media-safe * {
    font-family: system-ui, sans-serif !important;
    letter-spacing: normal !important;
    text-transform: none !important;
  }

  #mediaMenuBtn {
    position: fixed; top: 20px; left: 20px;
    width: 48px; height: 48px;
    background: #0b162ecc;
    border: 1px solid #29d9ff;
    color: #29d9ff;
    border-radius: 10px;
    font-size: 24px;
    cursor: pointer; z-index: 9999;
  }

  #mediaDrawer {
    position: fixed; top: 0; left: 0;
    width: 260px; height: 100%;
    background: #020712f8;
    border-right: 1px solid #29d9ff50;
    padding: 20px;
    transform: translateX(-100%);
    transition: 0.25s ease;
    z-index: 9998;
  }
  #mediaDrawer.open { transform: translateX(0); }

  #mediaDrawer h2, #mediaDrawer h3 {
    color: #29d9ff; margin-top: 20px;
  }

  .media-file {
    padding: 6px 0;
    border-bottom: 1px solid #133;
    cursor: pointer;
    color: #d7f2ff;
  }

  /* DOCK BUTTON */
  #dockBtn {
    position: fixed; bottom: 25px; right: 25px;
    width: 65px; height: 65px;
    border-radius: 50%;
    background: #29d9ff;
    border: none;
    box-shadow: 0 0 18px #29d9ff;
    font-size: 28px;
    color: #001019;
    font-weight: 900;
    cursor: pointer;
    z-index: 9999;
  }

  /* DOCK PANEL */
  #dockPanel {
    position: fixed; bottom: 0; left: 0;
    width: 100%; height: 55%;
    background: #020712ef;
    border-top: 1px solid #29d9ff40;
    padding: 18px;
    display: none;
    z-index: 9998;
    overflow-y: auto;
  }

  #mediaPlayer, #audioPlayer {
    width: 100%;
    margin-top: 14px;
    border-radius: 10px;
    background: #000;
  }

</style>

<!-- HAMBURGER BUTTON -->
<button id="mediaMenuBtn" class="media-safe">☰</button>

<!-- STORAGE DRAWER -->
<div id="mediaDrawer" class="media-safe">
  <h2>Storage</h2>

  <h3>Video</h3>
  <div id="storageVideo"></div>

  <h3>Audio</h3>
  <div id="storageAudio"></div>

  <h3>Other</h3>
  <div id="storageOther"></div>
</div>

<!-- DOCK BUTTON -->
<button id="dockBtn" class="media-safe">▶</button>

<!-- MEDIA DOCK PANEL -->
<div id="dockPanel" class="media-safe">
  <h2 style="color:#29d9ff; margin-top:0;">Media Player</h2>

  <input type="file" id="uploadMedia" accept="video/*,audio/*" />

  <video id="mediaPlayer" controls></video>
  <audio id="audioPlayer" controls></audio>
</div>

<script>
(function(){

  const menuBtn = document.getElementById("mediaMenuBtn");
  const drawer = document.getElementById("mediaDrawer");

  const dockBtn = document.getElementById("dockBtn");
  const dock = document.getElementById("dockPanel");

  const upload = document.getElementById("uploadMedia");
  const vPlayer = document.getElementById("mediaPlayer");
  const aPlayer = document.getElementById("audioPlayer");

  const storeKey = "inf_media_store_v2";
  let store = JSON.parse(localStorage.getItem(storeKey) || "[]");

  const vidBox = document.getElementById("storageVideo");
  const audBox = document.getElementById("storageAudio");
  const othBox = document.getElementById("storageOther");

  /* HAMBURGER TOGGLE */
  menuBtn.onclick = () => drawer.classList.toggle("open");

  /* DOCK PANEL */
  dockBtn.onclick = () => {
    dock.style.display = (dock.style.display==="none"||!dock.style.display) ? "block" : "none";
  };

  /* RENDER STORAGE */
  function render(){
    vidBox.innerHTML = "";
    audBox.innerHTML = "";
    othBox.innerHTML = "";

    store.forEach(file=>{
      let el=document.createElement("div");
      el.className="media-file";
      el.textContent=file.name;

      el.onclick = ()=>{
        if(file.type.startsWith("video")){
          aPlayer.style.display="none";
          vPlayer.style.display="block";
          vPlayer.src=file.data;
        } else if(file.type.startsWith("audio")){
          vPlayer.style.display="none";
          aPlayer.style.display="block";
          aPlayer.src=file.data;
        }
      };

      if(file.type.startsWith("video")) vidBox.appendChild(el);
      else if(file.type.startsWith("audio")) audBox.appendChild(el);
      else othBox.appendChild(el);
    });
  }

  render();

  /* UPLOAD HANDLER */
  upload.onchange = e=>{
    const file = e.target.files[0];
    if(!file) return;

    const rd = new FileReader();
    rd.onload = ()=>{
      const item = { name:file.name, type:file.type, data:rd.result };
      store.push(item);
      localStorage.setItem(storeKey, JSON.stringify(store));
      render();

      if(file.type.startsWith("video")){
        vPlayer.style.display="block"; aPlayer.style.display="none";
        vPlayer.src = rd.result;
      } else if(file.type.startsWith("audio")){
        aPlayer.style.display="block"; vPlayer.style.display="none";
        aPlayer.src = rd.result;
      }
    };

    rd.readAsDataURL(file);
  };

})();
</script>
<!-- ⬛ INFINITY MEDIA SYSTEM — MODERN, WORKING, NO CONFLICTS -->

<style>
  /* Isolate all styles in a namespace */
  .inf-media * {
    font-family: system-ui, sans-serif !important;
    letter-spacing: normal !important;
    text-transform: none !important;
    box-sizing: border-box;
  }

  /* Floating Media Button */
  #infMediaBtn {
    position: fixed; bottom: 24px; right: 24px;
    width: 70px; height: 70px;
    border-radius: 20px;
    border: none;
    background: linear-gradient(145deg, #29d9ff, #147a96);
    color: #001018;
    font-size: 32px;
    font-weight: 900;
    cursor: pointer;
    z-index: 99999;
    box-shadow: 0 0 24px #29d9ff;
  }

  /* Player Panel */
  #infMediaPanel {
    position: fixed; bottom: 0; left: 0;
    width: 100%; height: 63%;
    background: #020712f5;
    border-top: 2px solid #29d9ff70;
    border-radius: 18px 18px 0 0;
    padding: 20px;
    display: none;
    z-index: 99998;
  }

  #infMediaPanel h2 {
    margin: 0; color: #29d9ff;
    font-size: 22px;
  }

  /* Upload Area */
  #infDropZone {
    width: 100%;
    height: 120px;
    border: 2px dashed #29d9ff90;
    border-radius: 18px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #a6d9f7;
    margin-top: 16px;
    cursor: pointer;
  }

  /* Video Player */
  #infVideo {
    width: 100%;
    margin-top: 16px;
    border-radius: 12px;
    background: #000;
    outline: 2px solid #29d9ff40;
  }

  /* Save Button */
  #infSaveBtn {
    margin-top: 14px;
    padding: 12px 18px;
    background: linear-gradient(145deg, #29d9ff, #147a96);
    border: none; border-radius: 12px;
    font-size: 16px; font-weight: 700;
    cursor: pointer;
    color: #001018;
    width: 100%;
  }

  /* Hamburger Drawer */
  #infDrawerBtn {
    position: fixed; top: 20px; left: 20px;
    width: 52px; height: 52px;
    background: #0b162ecc;
    border: 2px solid #29d9ff;
    border-radius: 14px;
    color: #29d9ff;
    font-size: 26px;
    cursor: pointer; z-index: 99999;
  }

  #infDrawer {
    position: fixed; top: 0; left: 0;
    width: 300px; height: 100%;
    background: #020712fb;
    border-right: 2px solid #29d9ff50;
    transform: translateX(-100%);
    transition: 0.25s ease;
    padding: 20px;
    z-index: 99998;
  }

  #infDrawer.open { transform: translateX(0); }
  #infDrawer h3 { color: #29d9ff; margin-top: 20px; }
  .inf-item { color:#d7f2ff; padding:6px 0; cursor:pointer; border-bottom:1px solid #133; }
</style>

<div class="inf-media">

  <!-- Floating Buttons -->
  <button id="infDrawerBtn">☰</button>
  <button id="infMediaBtn">▶</button>

  <!-- Drawer -->
  <div id="infDrawer">
    <h2 style="color:#29d9ff;">Media Catalog</h2>
    <h3>Videos</h3><div id="infVidList"></div>
    <h3>Audio</h3><div id="infAudList"></div>
  </div>

  <!-- Media Panel -->
  <div id="infMediaPanel">
    <h2>Media Player</h2>

    <div id="infDropZone">Tap or Drop video/audio here</div>
    <input id="infUpload" type="file" accept="video/*,audio/*" style="display:none">

    <video id="infVideo" controls></video>
    <audio id="infAudio" controls style="width:100%;display:none;"></audio>

    <button id="infSaveBtn" style="display:none;">Save to Catalog</button>
  </div>

</div>

<script>
(function(){
  const p = id => document.getElementById(id);

  const panel = p("infMediaPanel");
  const btn = p("infMediaBtn");
  const drop = p("infDropZone");
  const upload = p("infUpload");
  const saveBtn = p("infSaveBtn");
  const video = p("infVideo");
  const audio = p("infAudio");
  const drawerBtn = p("infDrawerBtn");
  const drawer = p("infDrawer");
  const listVid = p("infVidList");
  const listAud = p("infAudList");

  let store = JSON.parse(localStorage.getItem("inf_catalog")||"[]");
  let current = null;

  btn.onclick = ()=> panel.style.display = (panel.style.display==="none"||!panel.style.display)?"block":"none";
  drawerBtn.onclick = ()=> drawer.classList.toggle("open");

  function render(){
    listVid.innerHTML=""; listAud.innerHTML="";
    store.forEach(item=>{
      const el=document.createElement("div");
      el.className="inf-item"; el.textContent=item.name;
      el.onclick=()=> loadMedia(item);
      if(item.type.startsWith("video")) listVid.appendChild(el);
      else listAud.appendChild(el);
    });
  }

  function loadMedia(file){
    current=file;
    if(file.type.startsWith("video")){
      video.style.display="block"; audio.style.display="none";
      video.src=file.data;
    } else {
      audio.style.display="block"; video.style.display="none";
      audio.src=file.data;
    }
  }

  drop.onclick = ()=> upload.click();
  drop.ondrop = e=>{
    e.preventDefault(); readFile(e.dataTransfer.files[0]);
  };
  drop.ondragover = e=> e.preventDefault();
  upload.onchange = ()=> readFile(upload.files[0]);

  function readFile(file){
    if(!file) return;
    const rd = new FileReader();
    rd.onload = ()=>{
      const data = rd.result;
      current = {name:file.name,type:file.type,data};
      saveBtn.style.display="block";
      loadMedia(current);
    };
    rd.readAsDataURL(file);
  }

  saveBtn.onclick = ()=>{
    store.push(current);
    localStorage.setItem("inf_catalog",JSON.stringify(store));
    render();
    saveBtn.style.display="none";
  };

  render();

})();
</script>
<!-- ▬▬▬ INFINITY FLOATING MEDIA VIEWER ▬▬▬ -->
<style>
  #infFloatPlayer {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 320px;
    height: 200px;
    background: #020712f0;
    border: 2px solid #29d9ff;
    border-radius: 14px;
    z-index: 999999;
    display: none;
    resize: both;
    overflow: hidden;
  }

  #infFloatHeader {
    width: 100%;
    height: 36px;
    background: linear-gradient(145deg, #29d9ff, #147a96);
    cursor: move;
    color: #001018;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 12px;
    font-weight: 700;
  }

  #infCloseFP {
    cursor:pointer;
    font-size: 20px;
  }

  #infVideoFP, #infAudioFP {
    width: 100%;
    height: calc(100% - 36px);
    background: #000;
  }

  #infUploadFP {
    position: fixed;
    bottom: 20px;
    right: 350px;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border:none;
    background: #29d9ff;
    color:#001018;
    font-size:28px;
    font-weight:900;
    cursor:pointer;
    z-index:999999;
    box-shadow:0 0 18px #29d9ff;
  }
</style>

<button id="infUploadFP">+</button>

<div id="infFloatPlayer">
  <div id="infFloatHeader">
    <span>Infinity Player</span>
    <span id="infCloseFP">✕</span>
  </div>
  <video id="infVideoFP" controls style="display:none;"></video>
  <audio id="infAudioFP" controls style="display:none;"></audio>
</div>

<script>
(function(){
  const fp = document.getElementById("infFloatPlayer");
  const hdr = document.getElementById("infFloatHeader");
  const close = document.getElementById("infCloseFP");
  const uploadBtn = document.getElementById("infUploadFP");
  const vid = document.getElementById("infVideoFP");
  const aud = document.getElementById("infAudioFP");

  let store = JSON.parse(localStorage.getItem("inf_library")||"[]");

  uploadBtn.onclick = ()=>{
    let uploader = document.createElement("input");
    uploader.type="file";
    uploader.accept="video/*,audio/*";
    uploader.onchange = e=>{
      let file = e.target.files[0];
      if(!file) return;

      let rd=new FileReader();
      rd.onload = ()=>{
        
        // Save to Infinity Library
        let item = {name:file.name, type:file.type, data:rd.result};
        store.push(item);
        localStorage.setItem("inf_library",JSON.stringify(store));

        // Load into player
        fp.style.display="block";

        if(file.type.startsWith("video")){
          vid.style.display="block";
          aud.style.display="none";
          vid.src = rd.result;
          vid.play();
        } else {
          vid.style.display="none";
          aud.style.display="block";
          aud.src = rd.result;
          aud.play();
        }
      };
      rd.readAsDataURL(file);
    };
    uploader.click();
  };

  close.onclick = ()=> fp.style.display="none";

  // Make window draggable
  let offsetX, offsetY, dragging=false;

  hdr.addEventListener("mousedown",e=>{
    dragging=true;
    offsetX=e.clientX - fp.offsetLeft;
    offsetY=e.clientY - fp.offsetTop;
  });

  document.addEventListener("mouseup",()=> dragging=false);

  document.addEventListener("mousemove",e=>{
    if(!dragging) return;
    fp.style.left = (e.clientX - offsetX)+"px";
    fp.style.top = (e.clientY - offsetY)+"px";
  });

})();
</script>
<script>
  // REMOVE OLD MEDIA PANEL IF PRESENT
  const oldPanel = document.querySelector("div[ id='dockPanel'], div[id='mediaDockPanel'], div[id='mediaPlayer'], section.terminal-card + div");
  if (oldPanel) oldPanel.remove();

  const oldUploader = document.querySelector("input[id='uploadMedia'], input[id='mediaUpload']");
  if (oldUploader) oldUploader.remove();
</script>
</body>
</html>
